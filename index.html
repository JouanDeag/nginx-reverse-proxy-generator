<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">


    <!-- Custom CSS -->
    <link rel="stylesheet" href="./assets/css/style.css">

    <!-- Custom JavaScript -->
    <script src="./assets/js/index.js"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@100;400&display=swap" rel="stylesheet">

    <title>Johans Dev - NGINX Reverse Proxy Generator</title>
</head>

<body>
    <!-- Title -->
    <h1 class="s-title">NGINX Reverse Proxy Generator</h1>

    <!-- Endpoint Input -->

    <div class="c-div">
        <input type="text" placeholder="Input Endpoint IP" class="IP list-input">
        <input type="number" placeholder="Input Endpoint Port" class="PORT list-input">
        <!-- <input type="button" value="Submit" class="addBtn list-input">
        <input type="button" value="Clear Endpoints" class="clearBtn list-input"> -->
    </div>
    
    <!-- <div class="endpoint-list margin-10">
        <ol class="list"></ol>
    </div>
    
    <script>
        let list = document.querySelector('.list');
        const addBtn = document.querySelector(".addBtn");
        const clearBtn = document.querySelector('.clearBtn');
        let ipInput = document.querySelector('.IP');
        let portInput = document.querySelector('.PORT');

        function deleteNote(e) {
        const parent = e.target.parentNode;
        parent.remove();
        }

        function addStuff() {
        
        const port = portInput.value;
        const note = ipInput.value;
        
        if(note.length == 0) return;
            
        const btn = document.createElement('button');
        btn.classList.add('del-btn');
        btn.type = 'button';
        btn.textContent = 'Delete';
        btn.addEventListener("click", (e) => deleteNote(e));
        
        const li = document.createElement('li');
        li.textContent = `${note}:${port} `;
        li.appendChild(btn);
        
        list.appendChild(li);
        
        portInput.value = "";
        }

        function clearEndpoints() {
        list.innerHTML  = ''
        portInput.value = "";
        ipInput.value = "";
        }

        addBtn.addEventListener("click", addStuff);
        clearBtn.addEventListener("click", clearEndpoints);       
    </script> -->

    <div class="c-div gen-div">
        <input type="button" onClick="generate(list)" value="Add to Config" class="gen-btn btn">
    </div>

<script>
    let portInput = document.querySelector('.PORT');
    portInput.addEventListener("keyup", function(event) {
        // Number 13 is the "Enter" key on the keyboard
        if (event.keyCode === 13) {
          // Cancel the default action, if needed
          event.preventDefault();
          // Trigger the button element with a click
          document.querySelector(".gen-btn").click();
        }
    });
</script>

<pre class="c-div">
    <code class="finalconfig">user www-data;
worker_processes auto;
pid /run/nginx.pid;
load_module /usr/lib/nginx/modules/ngx_stream_module.so;

events {
    worker_connections 768;
}

stream {
    </code>
</pre>
    <div class="c-div gen-div">
        <button onClick="clipboard(output)" class="btn">Copy Config</button>
    </div>

<pre>
    <script>
        let list = document.querySelector('.list');
        let ipInput = document.querySelector('.IP');
        portInput = document.querySelector('.PORT');
        const genbtn = document.querySelector(".gen-btn");
        let output = document.querySelector(".finalconfig")

        function generate (list) {
            if (ipInput.value == "" || portInput.value == "") return;
            console.log(output.append(`
    upstream ${portInput.value} {
        server ${ipInput.value}:${portInput.value};
    }

    server {
        listen ${portInput.value};
        proxy_pass ${portInput.value};
    }

    server {
        listen ${portInput.value} udp reuseport;
        proxy_pass ${portInput.value};
    }
`));

            output.innerHTML += "}"
            portInput.value = ""
        }

        function clipboard(output) {
            navigator.clipboard.writeText(output.innerHTML);
        }
    </script>


    <footer id="footer" class="c-div">
        <div id="footer-content"><a href="https://github.com/JouanDeag/nginx-reverse-proxy-generator" target="_blank" class="no-highlight">Copyright &copy; 2021 Johan Karlsson</a></div>
    </footer>



































</pre>
</body>
</html>